\hypertarget{_2home_2valentin_2_dropbox_2_a_v_i_o_n__r_c_2_prog_2_r_c_2src_2main_2control_8h-example}{}\section{/home/valentin/\+Dropbox/\+A\+V\+I\+O\+N\+\_\+\+R\+C/\+Prog/\+R\+C/src/main/control.\+h}
\hyperlink{class_control}{Control} class is responsible for translating \hyperlink{class_joystick}{Joystick}, encoder and button inputs into power, pitch, yaw and roll values \begin{DoxyNote}{Note}
Description of controls \+:
\begin{DoxyItemize}
\item C\+T\+R\+L1 \+: mode selector \+: Ground (off) / Flight (on))
\item C\+T\+R\+L2 \+: auto-\/thrust activation \+: Disable (off) / Enable (on)
\item C\+T\+R\+L3 \+: set auto-\/thrust to neutral (halfway)
\item C\+T\+R\+L4 \+: yaw activation \+: Disable (off) / Enable (on)
\item \hyperlink{class_encoder}{Encoder} \+:
\begin{DoxyItemize}
\item CW \+: auto-\/thrust cursor += get\+Setting(\+A\+U\+T\+O\+T\+H\+R\+U\+S\+T\+\_\+\+C\+U\+R\+S\+O\+R\+\_\+\+S\+T\+E\+P)
\item C\+CW \+: auto-\/thrust cursor -\/= get\+Setting(\+A\+U\+T\+O\+T\+H\+R\+U\+S\+T\+\_\+\+C\+U\+R\+S\+O\+R\+\_\+\+S\+T\+E\+P)
\item \hyperlink{class_switch}{Switch} (button) \+: reset auto-\/thrust to 0 (this is equivalent to temporarily disable auto-\/thrust) 
\end{DoxyItemize}
\end{DoxyItemize}

Description of control modes \+:
\begin{DoxyItemize}
\item Ground mode \+:
\begin{DoxyItemize}
\item Left joystick \+:
\begin{DoxyItemize}
\item X axis \+: nothing
\item Y axis \+: power (eventually reduced to map(power,0,255,0,get\+Setting(\+M\+A\+X\+\_\+\+G\+R\+O\+U\+N\+D\+\_\+\+P\+O\+W\+E\+R)) if get\+Setting(\+R\+E\+D\+U\+C\+E\+\_\+\+G\+R\+O\+U\+N\+D\+\_\+\+S\+P\+E\+E\+D) == true)
\end{DoxyItemize}
\item Right joystick \+:
\begin{DoxyItemize}
\item X axis \+: roll + yaw
\item Y axis \+: pitch
\end{DoxyItemize}
\end{DoxyItemize}
\item Flight mode \+:
\begin{DoxyItemize}
\item Left joystick \+:
\begin{DoxyItemize}
\item X axis \+: yaw
\item Y axis \+: power
\end{DoxyItemize}
\item Right joystick \+:
\begin{DoxyItemize}
\item X axis \+: roll
\item Y axis \+: pitch 
\end{DoxyItemize}
\end{DoxyItemize}
\end{DoxyItemize}

Description of auto-\/thrust \+:
\begin{DoxyItemize}
\item General case \+: power = cursor + map(joystick, min, max, halfway, max) //\+T\+O\+DO\+: check
\item Particular cases \+:
\begin{DoxyItemize}
\item When m\+\_\+auto\+Thrust\+Cursor = 0 \+: power = map(joystick, min, max, halfway, max)
\item When m\+\_\+auto\+Thrust\+Cursor = 128 (halfway) \+: power = joystick
\item When m\+\_\+auto\+Thrust\+Cursor = 255 (max) \+: power = max
\end{DoxyItemize}
\end{DoxyItemize}
\end{DoxyNote}

\begin{DoxyCodeInclude}

\textcolor{preprocessor}{#ifndef CONTROL\_H}
\textcolor{preprocessor}{#define CONTROL\_H}

\textcolor{preprocessor}{#include "\hyperlink{joystick_8h}{joystick.h}"}
\textcolor{preprocessor}{#include "\hyperlink{encoder_8h}{encoder.h}"}
\textcolor{preprocessor}{#include "\hyperlink{buzzer_8h}{buzzer.h}"}
\textcolor{preprocessor}{#include "\hyperlink{rgbled_8h}{rgbled.h}"}
\textcolor{preprocessor}{#include "\hyperlink{switch_8h}{switch.h}"}
\textcolor{preprocessor}{#include "\hyperlink{lcdscreen_8h}{lcdscreen.h}"}
\textcolor{preprocessor}{#include "\hyperlink{settings_8h}{settings.h}"}

\textcolor{preprocessor}{#define GROUND\_MODE 0}
\textcolor{preprocessor}{#define FLIGHT\_MODE 1}

\textcolor{preprocessor}{#define CONTROL\_IDLE 128}

\textcolor{keyword}{class }\hyperlink{class_control}{Control}
\{
\textcolor{keyword}{private}:
    \textcolor{keywordtype}{bool} m\_mode;
    uint8\_t m\_autoThrustCursor;

    \hyperlink{class_joystick}{Joystick} m\_leftJoy;
    \hyperlink{class_joystick}{Joystick} m\_rightJoy;
    \hyperlink{class_encoder}{Encoder} m\_encoder;
    \hyperlink{class_buzzer}{Buzzer} m\_buzzer;
    \hyperlink{class_r_g_b_led}{RGBLed} m\_rgbLed;
    \hyperlink{class_switch}{Switch} m\_CTRL1;
    \hyperlink{class_switch}{Switch} m\_CTRL2;
    \hyperlink{class_button}{Button} m\_CTRL3;
    \hyperlink{class_button}{Button} m\_CTRL4;
    \textcolor{comment}{//TODO: LCDScreen m\_screen;}
    \textcolor{keyword}{const} \hyperlink{class_settings}{Settings}* m\_p\_settings;
\textcolor{keyword}{public}:
    \hyperlink{class_control}{Control}();
    \textcolor{keywordtype}{void} \hyperlink{class_control_a435c342eba3a2598f3eb40e68fa1a263}{init}(\hyperlink{class_joystick}{Joystick} leftJoy\_p, \hyperlink{class_joystick}{Joystick} rioghtJoy\_p, 
      \hyperlink{class_encoder}{Encoder} encoder\_p, \hyperlink{class_switch}{Switch} gearSwitch\_p, \hyperlink{class_buzzer}{Buzzer} buzzer\_p, 
      \hyperlink{class_r_g_b_led}{RGBLed} rgbLed\_p, \textcolor{keyword}{const} \hyperlink{class_settings}{Settings}* p\_settings\_p);
    ~\hyperlink{class_control}{Control}();
    \textcolor{keywordtype}{void} \hyperlink{class_control_af7a1f77ddc2789d291e3193cfc046d50}{setMode}(\textcolor{keywordtype}{bool} newMode\_p);
    uint8\_t getPower();
    uint8\_t getPitch();
    uint8\_t getYaw();
    uint8\_t getRoll();
\};

\textcolor{preprocessor}{#endif}
\end{DoxyCodeInclude}
 